<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compact Note Generator — Reduced Preview Height</title>
  <style>
    :root{
      --accent-a: #bff0ff;
      --accent-b: #dfe9ff;
      --muted: #54606f;
      --card: rgba(255,255,255,0.94);
      --radius: 8px;
      --shadow: 0 8px 20px rgba(18,38,63,0.06);
      --maxw: 980px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(135deg, var(--accent-a) 0%, var(--accent-b) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px;
      color:#071129;
    }

    .shell{
      width:100%;
      max-width:var(--maxw);
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:12px;
      align-items:start;
    }
    label {
      font-weight: bold;
    }

    .card{
      background: var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid rgba(12,20,30,0.06);
    }

    .form-card{ padding:10px 12px; }

    /* Reduced overall vertical footprint for the preview card */
    .preview-card{
      padding:8px 10px;
      display:flex;
      flex-direction:column;
      min-height:220px; /* lowered */
      max-height:520px;
    }

    .title-row{ display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .logo{ width:36px; height:36px; border-radius:6px; background:linear-gradient(135deg,var(--accent-a),var(--accent-b)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700 }
    h1{ font-size:16px; margin:0 }
    .hint{ font-size:12px; color:var(--muted); margin-top:4px }

    form{ display:flex; flex-direction:column; gap:8px }
    .field{ display:flex; flex-direction:column; gap:4px }
    label{ font-size:12px; color:var(--muted); margin:0 }
    input[type="text"], input[type="tel"], select, textarea{
      font-size:13px; padding:8px 9px; border-radius:7px; border:1px solid rgba(10,20,30,0.06); outline:none;
      background:#fff; box-sizing:border-box;
    }
    input:focus,textarea:focus,select:focus{ box-shadow:0 10px 30px rgba(102,166,255,0.08); border-color:rgba(102,166,255,0.4) }
    textarea{ min-height:64px; resize:vertical; font-size:13px; padding-top:9px }

    .row2{ display:flex; gap:8px }
    .row2 .field{ flex:1 }

    .preview-header{ display:flex; align-items:center; gap:8px; justify-content:space-between; margin-bottom:8px }
    .preview-controls{ display:flex; gap:6px; align-items:center }
    .btn{ padding:7px 10px; border-radius:7px; border:0; font-weight:700; color:white; background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); cursor:pointer; font-size:13px }
    .btn.ghost{ background:transparent; color:var(--muted); border:1px solid rgba(10,20,30,0.06) }
    .btn.small{ padding:6px 8px; font-size:12px }

    /* NOTE: now sizes to content up to max-height — reduces empty space below last line */
    .note{
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98));
      border-radius:7px; padding:10px; font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      font-size:13px; color:#071129; white-space:pre-wrap; overflow:auto;
      flex: 0 1 auto;           /* let it size to content, but can shrink/grow */
      max-height: 260px;        /* cap height (changeable) */
    }

    .preview-footer{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:8px;
      align-items:center;
    }

    .muted{ color:var(--muted); font-size:12px }

    @media (max-width:900px){
      .shell{ grid-template-columns: 1fr; }
      .preview-card{ order:2 }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- FORM -->
    <div class="card form-card" aria-labelledby="formTitle">
      <div class="title-row">
        <div class="logo">
          <img src="https://kodenashi.github.io/pega/assets/pegalogo.png" alt="Pega" style="max-width:60px;">
        </div>
        <div>
          <h1 id="formTitle">Note Generator</h1>
          <div class="hint">Pega Notes - Efficiency at its finest</div>
        </div>
      </div>

      <form id="noteForm" autocomplete="off" onsubmit="return false;">
        <div class="row2">
          <div class="field">
            <label for="cid">CID</label>
            <input id="cid" name="cid" type="text">
          </div>
          <div class="field">
            <label for="cprod">CPROD</label>
            <input id="cprod" name="cprod" type="text">
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label for="phone">PHONE#</label>
            <input id="phone" name="phone" type="tel">
          </div>
          <div class="field">
            <label for="name">NAME</label>
            <input id="name" name="name" type="text">
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label for="authenticated">AUTHENTICATED (Y/N)</label>
            <select id="authenticated" name="authenticated" aria-label="Authenticated">
              <option value="">--Select--</option>
              <option value="Y">Y</option>
              <option value="N">N</option>
            </select>
          </div>
          <div class="field">
            <label for="domain">DOMAIN</label>
            <input id="domain" name="domain" type="text">
          </div>
        </div>

        <div class="field">
          <label for="concern">CONCERN</label>
          <textarea id="concern" name="concern" placeholder="Describe the concern..."></textarea>
        </div>

        <div class="field">
          <label for="actionDone">ACTION DONE</label>
          <textarea id="actionDone" name="actionDone" placeholder="Actions you took..."></textarea>
        </div>

        <div class="field">
          <label for="nextAction">NEXT ACTION</label>
          <textarea id="nextAction" name="nextAction"></textarea>
        </div>

        <div class="row2" style="align-items:flex-end">
          <div class="field" style="margin-bottom:0">
            <label for="osad">OSAD (Y/N)</label>
            <select id="osad" name="osad" aria-label="OSAD">
              <option value="">--Select--</option>
              <option value="Y">Y</option>
              <option value="N">N</option>
            </select>
          </div>

          <div style="display:flex;flex-direction:column;gap:6px">
            <div id="osadReasonWrap" style="display:none">
              <label for="osadReason">REASON</label>
              <select id="osadReason" name="osadReason">
                <option value="">—</option>
                <option value="Site Launch">Site Launch</option>
                <option value="Website Issue">Website Issue</option>
                <option value="SSL">SSL</option>
                <option value="SSL Issue">SSL Issue</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div id="osadOtherWrap" style="display:none">
              <label for="osadOther">OTHER (explain)</label>
              <textarea id="osadOther" name="osadOther" placeholder="Explain other reason..." style="min-height:58px"></textarea>
            </div>
          </div>
        </div>

      </form>
    </div>

    <!-- PREVIEW -->
    <div class="card preview-card" aria-labelledby="previewTitle">
      <div class="preview-header">
        <div>
          <h1 id="previewTitle" style="font-size:15px;margin:0">Realtime Preview</h1>
          <div class="muted" style="margin-top:4px;font-size:12px">Realtime notes you can directly copy</div>
        </div>
        <div style="width:1px"></div>
      </div>

      <div id="notePreview" class="note" aria-live="polite">-- Your note will appear here --</div>

      <div class="preview-footer" role="region" aria-label="Preview actions">
        <button id="copyBtn" class="btn small" title="Copy preview">Copy</button>
        <button id="resetBtn" class="btn ghost small" title="Reset form">Reset</button>
      </div>
    </div>
  </div>

  <script>
    function esc(s){ return String(s || '').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

    const els = {
      form: document.getElementById('noteForm'),
      cid: document.getElementById('cid'),
      cprod: document.getElementById('cprod'),
      phone: document.getElementById('phone'),
      name: document.getElementById('name'),
      authenticated: document.getElementById('authenticated'),
      domain: document.getElementById('domain'),
      concern: document.getElementById('concern'),
      actionDone: document.getElementById('actionDone'),
      nextAction: document.getElementById('nextAction'),
      osad: document.getElementById('osad'),
      osadReasonWrap: document.getElementById('osadReasonWrap'),
      osadReason: document.getElementById('osadReason'),
      osadOtherWrap: document.getElementById('osadOtherWrap'),
      osadOther: document.getElementById('osadOther'),
      notePreview: document.getElementById('notePreview'),
      copyBtn: document.getElementById('copyBtn'),
      resetBtn: document.getElementById('resetBtn')
    };

    function handleOsadChange(){
      if(els.osad.value === 'Y'){ els.osadReasonWrap.style.display = 'block'; }
      else { els.osadReasonWrap.style.display = 'none'; els.osadOtherWrap.style.display='none'; if(els.osadReason) els.osadReason.value=''; if(els.osadOther) els.osadOther.value=''; }
      render();
    }

    function handleReasonChange(){
      if(els.osadReason && els.osadReason.value === 'Other'){ els.osadOtherWrap.style.display = 'block'; }
      else { els.osadOtherWrap.style.display = 'none'; if(els.osadOther) els.osadOther.value=''; }
      render();
    }

    function buildPreviewText(){
      const v = {
        cid: els.cid.value.trim(),
        cprod: els.cprod.value.trim(),
        phone: els.phone.value.trim(),
        name: els.name.value.trim(),
        auth: els.authenticated.value.trim(),
        domain: els.domain.value.trim(),
        concern: els.concern.value.trim(),
        action: els.actionDone.value.trim(),
        next: els.nextAction.value.trim(),
        osad: els.osad.value.trim(),
        reason: els.osadReason ? els.osadReason.value.trim() : '',
        other: els.osadOther ? els.osadOther.value.trim() : ''
      };

      const idLines = [];
      idLines.push('CID: ' + esc(v.cid));
      idLines.push('CPROD: ' + esc(v.cprod));
      idLines.push('PHONE#: ' + esc(v.phone));
      idLines.push('NAME: ' + esc(v.name));

      const line2Parts = [];
      line2Parts.push('AUTHENTICATED (Y/N): ' + esc(v.auth || ''));
      if(v.domain) line2Parts.push('DOMAIN: ' + esc(v.domain));
      const authDomainLine = line2Parts.join(' • ');

      const concernLine = 'CONCERN: ' + esc(v.concern || '');
      const actionLine  = 'ACTION DONE: ' + esc(v.action || '');
      const nextLine    = 'NEXT ACTION: ' + esc(v.next || '');

      let osadLine = 'OSAD: ';
      if(v.osad === 'Y'){
        osadLine += 'Y';
        if(v.reason){
          osadLine += ' (' + esc(v.reason);
          if(v.reason === 'Other' && v.other) osadLine += ' - ' + esc(v.other);
          osadLine += ')';
        }
      } else if(v.osad === 'N'){
        osadLine += 'N';
      } else {
        osadLine += '';
      }

      const pieces = [];
      pieces.push(...idLines);
      if(authDomainLine) pieces.push(authDomainLine);
      pieces.push(concernLine);
      pieces.push(actionLine);
      pieces.push(nextLine);
      pieces.push(osadLine);

      return pieces.join('\n');
    }

    function render(){ els.notePreview.textContent = buildPreviewText(); }

    ['input','change'].forEach(ev => {
      [els.cid, els.cprod, els.phone, els.name, els.authenticated, els.domain, els.concern, els.actionDone, els.nextAction].forEach(el=>{
        if(el) el.addEventListener(ev, render);
      });
    });

    if(els.osad) els.osad.addEventListener('change', handleOsadChange);
    if(els.osadReason) els.osadReason.addEventListener('change', handleReasonChange);
    if(els.osadOther) els.osadOther.addEventListener('input', render);

    els.copyBtn.addEventListener('click', async ()=>{
      const text = buildPreviewText();
      try {
        await navigator.clipboard.writeText(text);
        const orig = els.copyBtn.textContent;
        els.copyBtn.textContent = 'Copied';
        setTimeout(()=> els.copyBtn.textContent = orig, 1200);
      } catch(e){
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); } catch(e){}
        ta.remove();
      }
    });

    els.resetBtn.addEventListener('click', ()=>{
      els.form.reset();
      handleOsadChange();
      handleReasonChange();
      render();
    });

    // initialize
    render();
  </script>
</body>
</html>
